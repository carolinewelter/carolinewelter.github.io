---
---
{%- comment -%}
APA-style Jekyll Scholar entry template (compact)
- No preview/thumb, no action pills or badges
- Year headings come from `--group_by year` in the calling page
- Authorship: "Last, F. M., Last, F. M., & Last, F. M."
- Reference: Authors (Year). Title. <em>Journal</em>, <em>Volume</em>(Issue), pages. DOI/URL
{%- endcomment -%}

{%- comment -%} Build APA-style author string {%- endcomment -%}
{%- capture apa_authors -%}
  {%- assign n = entry.author_array | size -%}
  {%- for a in entry.author_array -%}
    {%- assign initials = "" -%}
    {%- assign first_parts = a.first | split: ' ' -%}
    {%- for fp in first_parts -%}
      {%- capture initials -%}{{ initials }}{{ fp | slice: 0, 1 | upcase }}.{%- endcapture -%}
    {%- endfor -%}
    {%- assign name_formatted = a.last | append: ", " | append: initials -%}

    {%- if forloop.last and n > 1 -%}
      &nbsp;&amp;&nbsp;{{ name_formatted }}
    {%- elsif forloop.first -%}
      {{ name_formatted }}
    {%- else -%}
      , {{ name_formatted }}
    {%- endif -%}
  {%- endfor -%}
{%- endcapture -%}

{%- comment -%} Choose best link target (DOI > URL > PDF) {%- endcomment -%}
{%- assign doi_link = nil -%}
{%- if entry.doi %}{% assign doi_link = 'https://doi.org/' | append: entry.doi %}{% endif -%}
{%- assign best_link = doi_link | default: entry.url | default: entry.pdf -%}

{%- comment -%} Pieces for periodical line {%- endcomment -%}
{%- assign proceedings = "inproceedings,incollection" | split: ',' -%}
{%- assign thesis = "thesis,mastersthesis,phdthesis" | split: ',' -%}

{%- capture venue -%}
  {%- if entry.type == "article" and entry.journal -%}
    <em>{{ entry.journal }}</em>
  {%- elsif proceedings contains entry.type and entry.booktitle -%}
    <em>{{ entry.booktitle }}</em>
  {%- elsif thesis contains entry.type and entry.school -%}
    <em>{{ entry.school }}</em>
  {%- elsif entry.booktitle -%}
    <em>{{ entry.booktitle }}</em>
  {%- endif -%}
{%- endcapture -%}

{%- capture vol_issue -%}
  {%- if entry.volume %}<em>{{ entry.volume }}</em>{% endif -%}
  {%- if entry.number %}({{ entry.number }}){% endif -%}
{%- endcapture -%}

{%- capture pages -%}{% if entry.pages %}{{ entry.pages }}{% endif -%}{%- endcapture -%}
{%- capture year -%}{% if entry.year %}{{ entry.year }}{% endif -%}{%- endcapture -%}

<div id="{{ entry.key }}" class="bib-entry card mt-3 p-3">

  <!-- Authors and year -->
  <div class="apa-line">
    <span class="apa-authors">{{ apa_authors | strip }}</span>
    {% if year %} (<span class="apa-year">{{ year }}</span>).{% endif %}
  </div>

  <!-- Title -->
  <div class="apa-title">
    {% if best_link %}
      <a href="{{ best_link }}">{{ entry.title }}</a>.
    {% else %}
      {{ entry.title }}.
    {% endif %}
  </div>

  <!-- Venue, volume(issue), pages -->
  <div class="apa-venue">
    {{ venue }}
    {%- if venue and (vol_issue or pages) -%}, {% endif -%}
    {{ vol_issue }}{%- if vol_issue and pages -%}, {{ pages }}{%- endif -%}.
  </div>

  <!-- DOI / URL (APA prefers DOI) -->
  {% if doi_link %}
    <div class="apa-doi"><a href="{{ doi_link }}">{{ doi_link }}</a></div>
  {% elsif entry.url %}
    <div class="apa-doi"><a href="{{ entry.url }}">{{ entry.url }}</a></div>
  {% endif %}

  {% if entry.note %}
    <div class="apa-note">{{ entry.note | strip }}</div>
  {% endif %}

</div>
